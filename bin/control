#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

function status() {
  client_result "New Relic agent is enabled."
}

function configure_agent() {

  if [[ $JAVA_OPTS_EXT != *"${OPENSHIFT_NEWRELIC_AGENT_JAVA_OPTS}"* ]]; then
    env_dir=$OPENSHIFT_HOMEDIR/.env/user_vars
    env_var_value="${OPENSHIFT_NEWRELIC_AGENT_JAVA_OPTS} ${JAVA_OPTS_EXT}"
    set_env_var 'JAVA_OPTS_EXT' "$env_var_value" $env_dir
    client_result "New Relic agent re-enabled."  
  else
    client_result "New Relic agent enabled."
  fi
}

case "$1" in
  status)       
    status 
    ;;
  start|restart|reload)        
    configure_agent 
    ;;
  *)         	  
    exit 0
esac

#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

function status() {
  client_result "New Relic agent is enabled."
}

function start() {
  client_message "TEST1: $JAVA_OPTS_EXT"

  if [[ $JAVA_OPTS_EXT != *"${OPENSHIFT_NEWRELIC_AGENT_JAVA_OPTS}"* ]]; then
    env_dir=$OPENSHIFT_HOMEDIR/.env/user_vars
    env_var_value="${OPENSHIFT_NEWRELIC_AGENT_JAVA_OPTS} ${JAVA_OPTS_EXT}"
    
    #set_env_var 'JAVA_OPTS_EXT' "$env_var_value" $env_dir
  fi
  
  client_message "TEST2: $JAVA_OPTS_EXT"
    
  client_result "New Relic agent started."
}

case "$1" in
  status)       status ;;
  start)        start ;;
  *)         	  exit 0
esac
